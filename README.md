# Movie Rental API

**_Movie Rental API_** — это API для управления сервисом проката фильмов, включая фильмы, аренды, пользователей и платежи.

## Запуск

Для запуска используйте _Docker Compose_:

```docker-compose up --build```

Сервисы будут доступны по следующим портам:

- Swagger UI: [http://localhost:8080/ui](http://localhost:8080/ui)
- Prometheus: [http://localhost:9090](http://localhost:9090)
- Grafana: [http://localhost:3000](http://localhost:3000)

## Документация API
Вся информация о доступных эндпоинтах, параметрах и ответах описана в файле _swagger.yaml_.

### Методы API
- **GET /** — Получить список всех фильмов.
- **POST /movies** — Добавить новый фильм.
- **GET /movies/{movieId}** — Получить информацию о фильме по ID.
- **PUT /movies/{movieId}** — Обновить информацию о фильме.
- **DELETE /movies/{movieId}** — Удалить фильм.
- **GET /users** — Получить список всех пользователей.
- **POST /users** — Добавить нового пользователя.
- **GET /users/{userId}** — Получить информацию о пользователе по ID.
- **GET /rentals** — Получить список активных аренд.
- **POST /rentals** — Арендовать фильм.
- **GET /rentals/{rentalId}** — Получить информацию по конкретной аренде.
- **DELETE /rentals/{rentalId}** — Вернуть фильм.
- **POST /payments** — Провести платеж за аренду фильма.

## Метрики
API публикует набор метрик, которые используются для мониторинга приложения. Включают как стандартные метрики Python (например, _python_info_), так и кастомные, созданные для отслеживания конкретных показателей работы приложения.

### Стандартные метрики
- **python_info** — Общая информация о версии Python, используемой для работы приложения.
- **process_cpu_seconds_total** — Общее время процессора, затраченное на выполнение приложения.
- **process_resident_memory_bytes** — Объем памяти, который используется процессом приложения.
- И другие стандартные метрики, предоставляемые библиотеками Prometheus и Flask.

### Пользовательские метрики
- **request_count** — Счётчик общего количества запросов, отслеживающий количество вызовов API по HTTP-методу, эндпоинту и статусу.
- **request_latency_seconds** — Исторический график, который отображает время обработки каждого запроса.
- **error_count** — Счётчик ошибок, который отслеживает количество ошибок по HTTP-статусам для каждого эндпоинта.

Эти метрики собираются и предоставляются для мониторинга через **_Prometheus_**, а их визуализация доступна в **_Grafana_**.
Пример панели:

![image](https://github.com/user-attachments/assets/2c0b1915-258d-4e86-86d1-5cf385bc6fa1)

## Логи
API использует **_Grafana Loki_** для хранения и анализа логов. Логи собираются с использованием стандартных уровней логирования:
- **INFO** — Информация о штатной работе приложения (например, обработка запросов).
- **ERROR** — Сбои или ошибки в работе эндпоинтов.

Логи отправляются в **_Loki_** через **_Promtail_** и доступны для анализа в **_Grafana_**.
Пример панели:

![image](https://github.com/user-attachments/assets/31dbbe3b-f1ce-4960-b41e-b0694e5a9613)

